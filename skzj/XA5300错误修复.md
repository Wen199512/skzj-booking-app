# Android SDK 错误快速修复指南

## ?? 错误信息
```
XA5300: 找不到 Android SDK 目录
```

## ?? 首先检查工作负载状态

运行以下命令：

```cmd
dotnet workload list
```

### 情况 A: 显示 `android` 已安装 ?

如果看到：
```
android    36.1.12/10.0.100
```

**说明**：工作负载已安装，但环境变量未设置。

**跳转到**：[工作负载已安装但找不到SDK.md](工作负载已安装但找不到SDK.md)

**快速修复**：
```cmd
fix-android-path.bat
```

---

### 情况 B: 未显示 `android` ?

**说明**：需要安装 Android 工作负载。

**继续下面的步骤** ??

---

## ? 三步解决方案（工作负载未安装）

### 步骤 1: 安装 Android 工作负载

**选择其中一种方法：**

#### 方法 A: 使用自动安装脚本（推荐）
```cmd
install-android-sdk.bat
```

#### 方法 B: 手动命令
```cmd
dotnet workload install android
```

**等待时间**: 10-30 分钟  
**下载大小**: 约 1-3 GB

---

### 步骤 2: 重启终端

**重要**: 安装完成后，必须完全关闭并重新打开命令提示符或 PowerShell。

---

### 步骤 3: 验证并发布

```cmd
# 验证安装
dotnet workload list

# 应该看到:
# android    XX.X.XXX

# 如果仍然失败，运行路径修复
fix-android-path.bat

# 发布应用
publish-quick.bat
```

---

## ?? 验证是否成功安装

运行以下命令：

```cmd
# 检查工作负载
dotnet workload list | findstr "android"

# 检查环境变量
echo %ANDROID_HOME%
```

**成功标志**:
- ? `dotnet workload list` 显示 `android`
- ? `echo %ANDROID_HOME%` 显示路径（或运行 fix-android-path.bat 设置）
- ? 可以运行 `dotnet build -f net9.0-android`

---

## ?? 如果安装失败

### 错误: 权限不足
```cmd
# 以管理员身份运行 CMD
# 右键 "命令提示符" → "以管理员身份运行"
dotnet workload install android
```

### 错误: 网络超时
```cmd
# 清理并重试
dotnet workload clean
dotnet workload install android
```

### 错误: 已安装但仍提示找不到
```cmd
# 情况 1: 环境变量问题（最常见）
fix-android-path.bat

# 情况 2: 工作负载损坏
dotnet workload repair

# 情况 3: 完全重装
dotnet workload uninstall android
dotnet workload install android
```

---

## ?? 完整检查清单

**首次安装：**
- [ ] 运行 `dotnet workload list` 检查状态
- [ ] 如果未安装，运行 `dotnet workload install android`
- [ ] 等待安装完成（不要中断）
- [ ] 关闭所有终端窗口
- [ ] 重新打开命令提示符

**环境配置：**
- [ ] 运行 `fix-android-path.bat` 设置路径
- [ ] 或手动设置 `ANDROID_HOME` 环境变量
- [ ] 重启终端使环境变量生效

**验证：**
- [ ] 运行 `dotnet workload list` 确认 android 已安装
- [ ] 运行 `echo %ANDROID_HOME%` 确认路径已设置
- [ ] 运行 `publish-quick.bat` 发布

---

## ?? 快速参考命令

```cmd
# 检查工作负载状态
dotnet workload list

# 如果未安装（方法1：自动）
install-android-sdk.bat

# 如果未安装（方法2：手动）
dotnet workload install android

# 如果已安装但找不到SDK
fix-android-path.bat

# 诊断问题
diagnose.bat

# 发布应用
publish-quick.bat

# 手动验证
dotnet build -f net9.0-android
```

---

## ?? 决策树

```
运行: dotnet workload list
    |
    ├─ 显示 "android" → 工作负载已安装
    |   |
    |   └─ 运行: fix-android-path.bat
    |       └─ 重启终端
    |           └─ 运行: publish-quick.bat
    |
    └─ 未显示 "android" → 工作负载未安装
        |
        └─ 运行: install-android-sdk.bat
            └─ 等待安装完成
                └─ 重启终端
                    └─ 运行: fix-android-path.bat（如需要）
                        └─ 运行: publish-quick.bat
```

---

## ?? 重要提示

1. **首次安装需要 10-30 分钟**，请耐心等待
2. **必须重启终端**，否则环境变量不生效
3. **需要稳定的网络连接**，下载约 1-3 GB 数据
4. **需要 5-10 GB 磁盘空间**
5. **工作负载安装 ≠ 环境变量设置**，两个步骤都需要完成

---

## ?? 现在就开始

### 第一步：检查状态

```cmd
dotnet workload list
```

### 第二步：根据结果选择

**如果看到 `android` 已安装：**
```cmd
fix-android-path.bat
```

**如果未看到 `android`：**
```cmd
install-android-sdk.bat
```

### 第三步：重启终端后发布

```cmd
publish-quick.bat
```

完成！??

---

## ?? 详细文档

- **工作负载已安装但找不到SDK.md** - 环境变量配置详解
- **一步解决.md** - 最简化流程
- **Android_SDK_安装指南.md** - 完整安装教程
